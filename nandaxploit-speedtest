#!/bin/bash

# NandaXploit SpeedTest Tool
# Version: 1.0
# GitHub: https://github.com/[username]/nandaxploit-speedtest

# Colors
RED='\033[1;31m'
GREEN='\033[1;32m'
YELLOW='\033[1;33m'
BLUE='\033[1;34m'
CYAN='\033[1;36m'
PURPLE='\033[1;35m'
NC='\033[0m'

show_header() {
    clear
    echo -e "${RED}"
    echo "  _   _           _            __  ______  _       _ _ "
    echo " | \ | |         | |          / _| | ___ \(_)     (_) |"
    echo " |  \| | __ _  __| | ___  ___| |_  | |_/ / _ _ __ _| |_ "
    echo " | . \ |/ _\` |/ _\` |/ _ \/ _ \  _| |  __/ | | '__| | __|"
    echo " | |\  | (_| | (_| |  __/  __/ |   | |    | | |  | | |_ "
    echo " \_| \_/\__,_|\__,_|\___|\___|_|   \_|    |_|_|  |_|\__|"
    echo -e "${CYAN}"
    echo "         === Internet Speed Test Tool ==="
    echo -e "${NC}"
}

spinner() {
    local pid=$!
    local delay=0.1
    local spinstr='|/-\'
    while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
        local temp=${spinstr#?}
        printf " [%c]  " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

install_dependencies() {
    echo -e "${YELLOW}[*] Checking dependencies...${NC}"
    
    if ! command -v python &> /dev/null; then
        echo -e "${CYAN}[+] Installing Python...${NC}"
        pkg install python -y > /dev/null 2>&1
    fi
    
    if ! command -v speedtest-cli &> /dev/null; then
        echo -e "${CYAN}[+] Installing speedtest-cli...${NC}"
        pip install speedtest-cli > /dev/null 2>&1
    fi
}

run_speedtest() {
    show_header
    
    install_dependencies
    
    echo -e "${YELLOW}[*] Starting internet speed test...${NC}"
    echo ""
    
    # Ping test
    echo -ne "${CYAN}[+] Measuring ping...${NC}"
    ping -c 3 google.com > /tmp/ping.txt 2>&1 &
    spinner
    ping_result=$(grep "min/avg/max" /tmp/ping.txt | awk '{print $4}' | cut -d'/' -f2)
    echo -e "\r${CYAN}[+] Ping: ${YELLOW}${ping_result} ms${NC}"
    
    # Speedtest
    echo -ne "${CYAN}[+] Measuring download/upload speed...${NC}"
    speedtest-cli --simple > /tmp/speedtest.txt 2>&1 &
    spinner
    
    download=$(grep "Download" /tmp/speedtest.txt | awk '{print $2}')
    upload=$(grep "Upload" /tmp/speedtest.txt | awk '{print $2}')
    ping=$(grep "Ping" /tmp/speedtest.txt | awk '{print $2}')
    
    # Results
    echo -e "\n${PURPLE}╔════════════════════════════════════╗"
    echo -e "║          ${CYAN}NandaXploit Results${PURPLE}          ║"
    echo -e "╠════════════════════════════════════╣"
    echo -e "║ ${CYAN}Download${NC}: ${YELLOW}$(printf "%-18s" "$download Mbit/s")${PURPLE} ║"
    echo -e "║ ${CYAN}Upload${NC}  : ${YELLOW}$(printf "%-18s" "$upload Mbit/s")${PURPLE} ║"
    echo -e "║ ${CYAN}Ping${NC}    : ${YELLOW}$(printf "%-18s" "$ping ms")${PURPLE} ║"
    echo -e "╚════════════════════════════════════╝${NC}"
    echo ""
    
    echo -e "${GREEN}[✓] Speed test completed!${NC}"
    echo -e "${BLUE}Github: https://github.com/wordhubungixkm/nandaxploit-speedtest${NC}"
    echo ""
}

run_speedtest
